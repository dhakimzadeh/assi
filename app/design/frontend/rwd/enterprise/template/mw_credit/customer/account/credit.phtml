<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2009 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<div class="dashboard">
	<div class="page-title    page-head">
	    <?php if(version_compare(Mage::getVersion(),'1.4.0.1','>=')):?>
    		<h1><?php echo $this->__('Credit Manager') ?></h1>
    	<?php else: ?>
    		<h3><?php echo $this->__('Credit Manager') ?></h3>
    	<?php endif; ?>
	</div>
    <?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
		    <div class="account-box ad-account-info box-account box-info">
			    <div class="head box-head">
		    	    <?php if(version_compare(Mage::getVersion(),'1.4.0.1','>=')):?>
			    		<h2><?php echo $this->__('Current Balance') ?></h2>
			    	<?php else: ?>
			    		<h4><?php echo $this->__('Current Balance') ?></h4>
			    	<?php endif; ?>
			    	<?php 
			    		$customerId = Mage::getSingleton('customer/session')->getCustomer()->getId();
			    		$withdrawnType = Mage::getModel('affiliate/affiliatecustomers')->load($customerId)->getAutoWithdrawn();
			    		
			    		//If Withdrawn Type is manual
						//1Check Affiliate Withdrawal config-->
			    		if(Mage::getStoreConfig('affiliate/money/enable_withdrawal') && intval($withdrawnType) == MW_Affiliate_Model_Autowithdrawn::MANUAL): ?>
							<a href="<?php echo Mage::getUrl('affiliate/index/withdrawn')?>" style="padding-left:10px">Request Withdrawn</a>			    			
			    	<?php endif; ?>
			    </div>
		    	<?php echo $this->getChildHtml('credit_info'); ?>
		    </div>
		    
		    
		    <?php $size = Mage::helper('credit')->getSizeCreditHistoryByCustomer();?>
			    <?php if($this->getChild('credit_transaction')):?>
			    <div class="box-account box-recent account-box ad-orders">
			        <div class="head box-head">
			            <h2><?php echo $this->__('Transaction History') ?></h2>
			        </div>
			        <?php 
			        	if($size > 0) {
			        		echo $this->getChildHtml('credit_transaction');
			        	} else if($size == 0) { ?>
			        <div><?php echo $this->__('No Credit Transaction History Found') ?></div>
			        <?php }?>
			    </div>
			    <?php endif;?>
			    <?php //$credit = Mage::helper('credit')->getCreditByCustomer() ?> 
			    <?php //if($credit > 0):?>   
			    <?php //if(Mage::helper('credit')->allowSendCreditToFriend()):?>
			    	<?php //echo $this->getChildHtml('send') ?>
			    <?php // endif;?>
		    <?php // endif;?>
		
</div>

